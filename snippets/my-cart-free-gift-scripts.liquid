
<script type="module">
        import { cartRequestAdd, cartRequestChange, subscribeToCartStateUpdate } from '{{ "liquid-ajax-cart-v1.10.0.js" | asset_url }}';


        subscribeToCartStateUpdate( state => {

        	let items = state.cart.items;
            const totalItemsInCart = state.cart.item_count;

            const giftTriggerItem = items.filter(item => {
            	return item.handle === 'therapiedecken';
            });

            console.log("giftTriggerItem.length: ");
            console.log(giftTriggerItem);

            const autoAddedLineItem = state.cart.items.findIndex( lineItem => { 
              return lineItem.properties?._autoadded === 'Yes' ;
            });
    
            if ( giftTriggerItem.length >= 1 ){
              cartRequestAdd({ 
                items: [
                  {
                    id: 34447711174795,
                    quantity: 1,
                    properties: {
                  	"_autoadded": "Yes" 
                      }
                    }
                  ]  
              });
            } else if (giftTriggerItem.length <= -1) {
              // If trigger product is erased or does not exist
              // and an autoadded product is still in the cart lets remove it
              if ( autoAddedLineItem > -1 ) {
                cartRequestChange({ 
                  "line": autoAddedLineItem + 1,
                  "quantity": 0
                });
              }
            }
         });
         
</script>


