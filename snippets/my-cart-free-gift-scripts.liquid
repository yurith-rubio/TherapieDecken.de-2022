
<script type="module">
        import { cartRequestAdd, cartRequestChange, subscribeToCartStateUpdate } from '{{ "liquid-ajax-cart-v1.10.0.js" | asset_url }}';


        subscribeToCartStateUpdate( state => {

			// get items from the cart
        	let items = state.cart.items;
            const totalItemsInCart = state.cart.item_count;

			// check if trigger product is on the cart
            const giftTriggerItem = items.filter(item => {
            	return item.handle === 'therapiedecken';
            });

			// 
            let giftItem = items.filter(item => {
            	const giftItemHandle = item.handle;
            	return giftItemHandle === 'therapiedecken-basic-bezug-in-weiss';
            });
            
            // 
            
            console.log("giftItem: ");
            console.log(giftItem);

			// check if there is any gift product already added to the cart
            const autoAddedLineItem = state.cart.items.findIndex( lineItem => { 
              return lineItem.properties?._autoadded === 'Yes' ;
            });
            
            console.log("autoAddedLineItem: ");
            console.log(autoAddedLineItem);
            
            // add a gift product if there is a trigger product on the cart
            if ( giftTriggerItem.length >= 1 && autoAddedLineItem <= -1 ){
              cartRequestAdd({ 
                items: [
                  {
                    handle: 'therapiedecken-basic-bezug-in-weiss',
                    quantity: 1,
                    variant_options: {
                    	0: '135 x 200 cm';
                        1: 'Gravity (Schlaufen)'
                    }
                    properties: {
                  	"_autoadded": "Yes" 
                      }
                    }
                  ]  
              });
            } 
         });
         
</script>


